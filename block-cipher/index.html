<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Strong cryptography tools and password hashing.">  
    <link rel="canonical" href="https://docs.laminas.dev/block-cipher/">
    <link rel="shortcut icon" href="/img/trademark-laminas-foundation-rgb.svg">

    <title>Block Ciphers - laminas-crypt - Laminas Docs</title>

    <link rel="stylesheet" href="/css/styles.css">
</head>
<body id="page-top" class="components">

    
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
        
        <a class="logo-link navbar-brand offset-md-2" href="https://getlaminas.org/" data-tooltip data-placement="bottom" title="Go to the Laminas homepage">
            <img src="../img/laminas-foundation-white.svg" height="28" alt="Lamnias">
        </a>
        <a class="navbar-title" href="https://docs.laminas.dev/" data-tooltip data-placement="bottom" title="Go to the Laminas Documentation">
            Documentation
        </a>

        
        <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">

            
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a href="https://getlaminas.org/about" class="nav-link">About</a>
                </li>
                <li class="nav-item">
                    <a href="https://getlaminas.org/blog" class="nav-link">Blog</a>
                </li>
                <li class="nav-item">
                    <a href="https://docs.laminas.dev" class="nav-link">All Docs</a>
                </li>
                <li class="nav-item">
                    <a href="https://getlaminas.org/participate" class="nav-link">Community</a>
                </li>
            </ul>

            
            
                <div class="d-block d-sm-none">
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="..">laminas-crypt</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item ">
                                <a href="../intro/" class="subnavigation__link">Introduction</a>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item">
                                <span class="subnavigation__headline">Reference</span>
                                <ul class="subnavigation__list">
                                    
                                        
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">Block Ciphers</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../files/" class="subnavigation__link">Encrypting Files</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../hybrid/" class="subnavigation__link">Hybrid Cryptosystem</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../key-derivation/" class="subnavigation__link">Key Derivation</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../password/" class="subnavigation__link">Password</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../public-key/" class="subnavigation__link">Public Key Cryptography</a>
    </li>

                                    
                                </ul>
                            </li>
                        
                    
                
            
        </ul>
    </div>

                </div>
            

            
            <div class="d-block d-sm-none">
                <div class="component-selector">
    
    <h5 class="component-selector__subtitle">Find documentation…</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
            </div>
        </div>
    </div>
</nav>

    
    <header class="header">
    <div class="container">
        <div class="row">

            
            <div class="col-6 offset-md-2">
                <h1 class="header__title">
                    Components

                    
                        <small class="header__subtitle">laminas-crypt</small>
                    
                </h1>
            </div>

            
            <div class="col-4 text-sm-right">
                
                    

                    <a href="#" class="header__link header__link--search" data-toggle="modal" data-target="#mkdocs_search_modal" title="Open search">
                        <i class="fa fa-search"></i> Search
                    </a>
                    <a href="https://github.com/laminas/laminas-crypt/" class="header__link header__link--github" title="Go to repository of laminas-crypt">
                        <i class="fa fa-github"></i> GitHub
                    </a>
                
            </div>
        </div>
    </div>
</header>

    
    <div class="container">
        <div class="row">
            <div class="col-md-2 col-sm-12">
                
    

    
    
        <div class="toc">
            <h6 class="toc__headline">On this page</h6>
            <ul class="toc__list">
                
                    <li class="toc__entry">
                        <a href="#using-gcm-or-ccm-mode-from-php-71" class="toc__link">Using GCM or CCM Mode from PHP 7.1+</a>
                    </li>
                
            </ul>
        </div>
    

            </div>
            <div class="col-md-7 col-sm-12 content" role="main" data-spy="scroll" data-target=".toc">
                
                    <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        
            <li class="breadcrumb-item"><a href="">Overview</a></li>

            
                <li class="breadcrumb-item"><a href="..">laminas-crypt</a></li>

                
                    
                        
                        
                            <li class="breadcrumb-item">Reference</li>
                        
                    
                

                <li class="breadcrumb-item active" aria-current="page">Block Ciphers</li>
            
        
    </ol>
</nav>






    
    
        <h2 class="chapter__headline">Reference</h2>
    

    <h1 id="block-ciphers">Block Ciphers</h1>
<p><code>Laminas\Crypt\BlockCipher</code> implements encrypt-then-authenticate mode using
<a href="http://en.wikipedia.org/wiki/HMAC">HMAC</a> to provide authentication.</p>
<p>The symmetric cipher can be chosen with a specific adapter that implements
<code>Laminas\Crypt\Symmetric\SymmetricInterface</code>. We support the symmmetric encryption
algorithms offered by <a href="http://php.net/manual/en/book.openssl.php">OpenSSL</a> and
<a href="http://php.net/manual/en/book.mcrypt.php">Mcrypt</a> extensions.</p>
<p>In the following code, we detail an example of using the <code>BlockCipher</code> class to
encrypt-then-authenticate a string using the
<a href="http://en.wikipedia.org/wiki/Advanced_Encryption_Standard">AES-256</a> block cipher
and the HMAC algorithm (using the <a href="http://en.wikipedia.org/wiki/SHA-2">SHA-256</a>
hash function).</p>
<blockquote>
<h3>Mcrypt</h3>
<p>The Mcrypt extension is based on the libmcrypt library. Unfortunately, at the
time of writing, the project is dead, having been unmaintained for around 8
years, with the last release (version 2.5.8) having occurred in February 2007.</p>
<p>Starting with PHP 7.1, the Mcrypt extension will be
<a href="https://wiki.php.net/rfc/mcrypt-viking-funeral">considered deprecated</a>.
For these reasons, <strong>we strongly suggest using only the Openssl adapter</strong>.</p>
<p>Starting with laminas-crypt 3.0, the Openssl adapter is the default (for example,
by <code>Laminas\Crypt\FileCipher</code>), and all examples now only demonstrate that
adapter.</p>
</blockquote>
<p> <div class=codehilite><pre><span></span><span class=x>use Laminas\Crypt\BlockCipher;</span>

<span class=x>$blockCipher = BlockCipher::factory(&#39;openssl&#39;, array(&#39;algo&#39; =&gt; &#39;aes&#39;));</span>
<span class=x>$blockCipher-&gt;setKey(&#39;encryption key&#39;);</span>
<span class=x>$result = $blockCipher-&gt;encrypt(&#39;this is a secret message&#39;);</span>
<span class=x>echo &quot;Encrypted text: $result\n&quot;;</span>
</pre></div></p>
<p>The <code>BlockCipher</code> instance is initialized using a factory method with the name
of the cipher adapter to use (e.g., <code>openssl</code>) and the parameters to pass to the adapter
(the AES algorithm). In order to encrypt a string, we need to specify an
encryption key, which we do via the <code>setKey()</code> method. Encryption is performed
with the <code>encrypt()</code> method.</p>
<p>The output of encryption is a string, encoded in Base64 (default), containing
the HMAC value, the IV vector, and the encrypted text. The encryption mode used
is <a href="http://en.wikipedia.org/wiki/Block_cipher_modes_of_operation#Cipher-block_chaining_.28CBC.29">CBC</a>
(with a random <a href="http://en.wikipedia.org/wiki/Initialization_vector">IV</a> by
default), with the default HMAC hash algorithm of SHA256.  The Openssl adapter
encrypts using the <a href="http://en.wikipedia.org/wiki/Padding_%28cryptography%29">PKCS#7 padding</a>
mechanism by default. You can specify a different padding method using a special
adapter (<code>Laminas\Crypt\Symmetric\Padding</code>). The encryption and authentication keys
used by <code>BlockCipher</code> are generated with the <a href="http://en.wikipedia.org/wiki/PBKDF2">PBKDF2</a>
algorithm, used as the key derivation function from the user's key specified
using the <code>setKey()</code> method.</p>
<blockquote>
<h3>Key Size</h3>
<p>BlockCipher always attempts to use the longest key size for the specified
cipher. For instance, for the AES algorithm it uses 256 bits, and for the
<a href="http://en.wikipedia.org/wiki/Blowfish_%28cipher%29">Blowfish</a> algorithm it
uses 448 bits.</p>
</blockquote>
<p>You can change all the default settings by passing the values to the factory
parameters. For instance, if you want to use the Blowfish algorithm, with the
CFB mode and the HMAC SHA512 hash function, initialize the class as follows:</p>
<p> <div class=codehilite><pre><span></span><span class=x>use Laminas\Crypt\BlockCipher;</span>

<span class=x>$blockCipher = BlockCipher::factory(</span>
<span class=x>    &#39;openssl&#39;,</span>
<span class=x>    [</span>
<span class=x>        &#39;algo&#39; =&gt; &#39;blowfish&#39;,</span>
<span class=x>        &#39;mode&#39; =&gt; &#39;cfb&#39;,</span>
<span class=x>        &#39;hash&#39; =&gt; &#39;sha512&#39;</span>
<span class=x>    ]</span>
<span class=x>);</span>
</pre></div></p>
<blockquote>
<h3>Recommendation</h3>
<p>If you are not familiar with symmetric encryption techniques, we strongly
suggest using the default values of the <code>BlockCipher</code> class. The default
values are: AES algorithm, CBC mode, HMAC with SHA256, PKCS#7 padding.</p>
</blockquote>
<p>To decrypt a string we can use the <code>decrypt()</code> method. In order to successfully
decrypt a string, we must configure the <code>BlockCipher</code> with the same parameters
used during encryption.</p>
<p>We can also initialize the <code>BlockCipher</code> manually without using the factory method;
we can inject the symmetric cipher adapter directly via the constructor.
For instance, we can rewrite the previous example as follows:</p>
<p> <div class=codehilite><pre><span></span><span class=x>use Laminas\Crypt\BlockCipher;</span>
<span class=x>use Laminas\Crypt\Symmetric\Openssl;</span>

<span class=x>$blockCipher = new BlockCipher(new Openssl([&#39;algo&#39; =&gt; &#39;aes&#39;]));</span>
<span class=x>$blockCipher-&gt;setKey(&#39;encryption key&#39;);</span>
<span class=x>$result = $blockCipher-&gt;encrypt(&#39;this is a secret message&#39;);</span>
<span class=x>echo &quot;Encrypted text: $result \n&quot;;</span>
</pre></div></p>
<h2 id="using-gcm-or-ccm-mode-from-php-71">Using GCM or CCM Mode from PHP 7.1+</h2>
<p>If you are using PHP 7.1+ you can choose the GCM or CCM mode for authenticated
encryption with OpenSSL. These modes provide authenticated encryption by itself,
without the usage of HMAC as described in the previous section.</p>
<p>GCM is <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Galois/Counter Mode</a>
and CCM is <a href="https://en.wikipedia.org/wiki/CCM_mode">Counter with CBC-MAC</a>.
For more information on the usage of this encryption modes in PHP we suggest to
read <a href="http://www.zimuel.it/authenticated-encrypt-with-openssl-and-php-7-1/">this blog post</a>.</p>
<p>If you want to use the GCM or CCM mode with <code>BlockCipher</code> you can just specify
the mode in the factory. For instance, the following is an example of
<code>aes-256-gcm</code> encryption with OpenSSL:</p>
<p> <div class=codehilite><pre><span></span><span class=x>use Laminas\Crypt\BlockCipher;</span>

<span class=x>$blockCipher = BlockCipher::factory(</span>
<span class=x>    &#39;openssl&#39;,</span>
<span class=x>    [</span>
<span class=x>        &#39;algo&#39; =&gt; &#39;aes&#39;,</span>
<span class=x>        &#39;mode&#39; =&gt; &#39;gcm&#39;</span>
<span class=x>    ]</span>
<span class=x>);</span>
</pre></div></p>
<p>And below is an example demonstrating the factory for <code>aes-256-ccm</code> algorithm:</p>
<p> <div class=codehilite><pre><span></span><span class=x>use Laminas\Crypt\BlockCipher;</span>

<span class=x>$blockCipher = BlockCipher::factory(</span>
<span class=x>    &#39;openssl&#39;,</span>
<span class=x>    [</span>
<span class=x>        &#39;algo&#39; =&gt; &#39;aes&#39;,</span>
<span class=x>        &#39;mode&#39; =&gt; &#39;ccm&#39;</span>
<span class=x>    ]</span>
<span class=x>);</span>
</pre></div></p>
<blockquote>
<h3>Recommendation</h3>
<p><strong>GCM mode is about 3x faster than CCM</strong>, we recommend using GCM unless
you have requirements that dictate CCM.</p>
</blockquote>




    <nav>
    <ul class="page-nav hidden-print">

        
        <li class="page-nav__item">
            
                <a rel="prev" class="page-nav__link page-nav__link--prev" href="../intro/">
                    <i class="fa fa-chevron-left"></i> Previous
                </a>
            
        </li>

        
        <li class="page-nav__item">
            
                <a rel="next" class="page-nav__link page-nav__link--next" href="../files/">
                    Next <i class="fa fa-chevron-right"></i>
                </a>
            
        </li>
    </ul>
</nav>




    <div class="help-wanted">
        <p>
            Found a mistake or want to contribute to the documentation?
            <a href="https://github.com/laminas/laminas-crypt/edit/master/docs/book/block-cipher.md" target="_blank" class="help-wanted__link">
                Edit this page on GitHub!
            </a>
        </p>
    </div>

                
            </div>
            <div class="col-md-3 col-sm-12 sidebar">
                
                    <div class="component-selector">
    
    <h5 class="component-selector__subtitle">Find documentation…</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="..">laminas-crypt</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item ">
                                <a href="../intro/" class="subnavigation__link">Introduction</a>
                            </li>
                        
                    
                
            

                
                

                    
                    
                        
                            <li class="subnavigation__list-item">
                                <span class="subnavigation__headline">Reference</span>
                                <ul class="subnavigation__list">
                                    
                                        
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">Block Ciphers</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../files/" class="subnavigation__link">Encrypting Files</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../hybrid/" class="subnavigation__link">Hybrid Cryptosystem</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../key-derivation/" class="subnavigation__link">Key Derivation</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../password/" class="subnavigation__link">Password</a>
    </li>

                                    
                                        
    <li class="subnavigation__list-item ">
        <a href="../public-key/" class="subnavigation__link">Public Key Cryptography</a>
    </li>

                                    
                                </ul>
                            </li>
                        
                    
                
            
        </ul>
    </div>

                
            </div>
        </div>
    </div>

    
    <footer class="footer">
    <div class="container">

        
        <div class="row">
            <div class="col-md-12 text-center">
                <a class="footer__button" href="#page-top"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="row">
            <div class="col-md-7 offset-md-2">
                <h5>Laminas</h5>
                <ul>
                    <li>Laminas Project <a href="https://getlaminas.org/">Components and MVC for Enterprise Applications</a></li>
                    <li>Mezzio <a href="https://docs.mezzio.dev/">PSR-15 Middleware in Minutes</a></li>
                    <li>Laminas API Tools: <a href="https://api-tools.getlaminas.org/">Build RESTful APIs in minutes</a></li>
                </ul>
            </div>
        </div>

        <div class="row">

            
            <div class="col-md-4 offset-md-2">
                <h4 class="footer__headline">Support</h4>
                <ul class="support__list">
                    <li class="support__list-item">
                        <a href="https://discourse.laminas.dev" class="support__link" title="Forum"><i class="fa fa-comments"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://laminas.dev/chat" class="support__link" title="Chat"><i class="fa fa-slack"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://github.com/laminas" class="support__link" title="Github"><i class="fa fa-github"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://twitter.com/getlaminas" class="support__link" title="Twitter"><i class="fa fa-twitter"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://getlaminas.org/blog/feed-rss.xml" class="support__link" title="Blog feed"><i class="fa fa-rss"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://getlaminas.org/security/feed" class="support__link" title="Security feed"><i class="fa fa-rss-square"></i></a>
                    </li>
                </ul>
            </div>

            
            <div class="col-md-3">
                <h4 class="footer__headline">License</h4>
                <p>
                    Code licensed under <a
                        href="https://github.com/laminas/laminas-crypt//blob/master/LICENSE.md">BSD 3-Clause</a>.
                </p>
            </div>

            
            <div class="col-md-3">
                <h4 class="footer__headline">Copyright</h4>
                <p>
                    <!--Built with love by the Laminas team with the help of our
                    <a href="https://github.com/laminas/laminas-crypt//graphs/contributors">contributors</a>.<br>-->
                    &copy; 2019-2019 by <a href="https://getlaminas.org/">The Laminas Project</a>.
                </p>
            </div>
        </div>
    </div>
</footer>

    <script>
        let base_url = '..',
            project  = "components",
            siteName = 'laminas-crypt';
    </script>
    <script src="/js/scripts.js"></script>
        <script src="../search/main.js"></script>

    
    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Search</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
            </div>
            <div class="modal-body">
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search in laminas-crypt" id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
        </div>
    </div>
</div>
</body>


</html>
